sudo: false
language: crystal
services:
  - docker
crystal:
  - latest
notifications:
  email: false
before_install:
  - git clone -b diversity https://github.com/goodmind/cycle-telegram
  - cd $PWD/check-types
  - crystal deps
  - mkdir bin
  - crystal build ./src/check-types.cr -o ./bin/check-types
  - chmod +x ./bin/check-types
before_script:
  - docker build -t chrysler .
  - docker run chrysler /bin/sh -c "cd /root/remote-types; npm prune"
  - docker run chrysler /bin/sh -c "npm i -g /root/remote-types"
script:
  - docker run chrysler /bin/sh -c "check-types update /root/cycle-telegram/src/runtime-types"
  - docker run chrysler /bin/sh -c "check-types /root/cycle-telegram/src/runtime-types"
branches:
  except:
    - /^v\d+\.\d+\.\d+$/
